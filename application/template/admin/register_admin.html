<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>Metronic | Page Layouts - Blank Page</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/pace/pace.min.js" type="text/javascript"></script>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/pace/themes/pace-theme-barber-shop.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<link href="{%$VIEW_ROOT%}/assets/admin/pages/css/news.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
<link rel="stylesheet" type="text/css" href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css"/>
<!-- BEGIN THEME STYLES -->
<link href="{%$VIEW_ROOT%}/assets/global/css/components.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link id="style_color" href="{%$VIEW_ROOT%}/assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/umeditor/themes/default/css/umeditor.min.css" type="text/css" rel="stylesheet">
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
<!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
<!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
<!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
<!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
<!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
<!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
<body class="page-header-fixed page-quick-sidebar-over-content">
{%include file='admin/public/header.html'%}
<!-- BEGIN CONTAINER -->
<div class="page-container">
	<!-- BEGIN SIDEBAR -->
	{%include file='admin/public/sidebar.html'%}
	<!-- END SIDEBAR -->
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
        	<div id="alert">
            </div>
			<!-- BEGIN STYLE CUSTOMIZER -->
			{%include file='admin/public/style.html'%}
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->
			<h3 class="page-title">
			活动中心 <small>注册活动</small>
			</h3>
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="{%url c=index a=index%}">首页</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">活动中心</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="{%url c=register a=admin%}">注册活动</a>
					</li>
				</ul>
			</div>
			<!-- END PAGE HEADER-->
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
                	<div class="col-md-6">
                         <form action="" method="post" role="form" id="container_form" class="display-none">
                            <div class="form-group">
                                <button type="submit" name="submit" class="btn green">保存 <i class="fa fa-share"></i></button>
                                <a class="btn btn-danger pull-right" id="cancelBtn">取消 <i class="fa fa-share"></i></a>
                            </div>
                            <div class="form-group">
                            <input type="text" placeholder="标题" name="title" class="form-control">
                            </div>
                            <script id="umeditor" name="content" type="text/plain"></script>
                        </form>
                        <div class="col-md-12" id="container">
                        	<div class="news-blocks">
								<h3>
								<a id="title" href="{%url c=register a=information id=1 type=code%}">
								</a>
								</h3>
								<div class="news-block-tags">
									<button class="btn btn-xs green-strips" id="editBtn">编辑</button>
								</div>
                                <hr>
								<p id="content">
                                </p>
							</div>
                        </div>
                        
                    </div>
                    <div class="col-md-6">
                    	<form role="form" class="form-horizontal" id="externData">
                    	<div class="form-group">
                            <label class="control-label col-md-2">活动时间</label>
                            <div class="col-md-10">
                                <div class="input-group date-picker input-daterange" data-date-format="yyyy-mm-dd">
                                    <input type="text" class="form-control" name="starttime" value="{%$register.starttime|date_format:"Y-m-d"%}">
                                    <span class="input-group-addon">
                                    到 </span>
                                    <input type="text" class="form-control" name="endtime" value="{%$register.endtime|date_format:"Y-m-d"%}">
                                </div>
                                <!-- /input-group -->
                                <span class="help-block">
                                选择时间段 </span>
                            </div>
                        </div>
                        <div class="form-group">
                        	<label class="control-label col-md-2">优惠券模板</label>
                            <div class="col-md-10">
                            	<select class="form-control" name="template_coupon">
                                	{%section name=coupon loop=$coupon%}
                                    <option value="{%$coupon[coupon].id%}" {%if $coupon[coupon].id == $register.template_coupon%}selected="selected"{%/if%}>{%$coupon[coupon].couponno%}</option>
                                    {%/section%}
                                </select>
                            </div>
                        </div>
                        <!--<div class="form-group">
                        	<label class="control-label col-md-2">赠送优惠券次数</label>
                            <div class="col-md-10">
                            	<input type="text" name="num" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-2">优惠券有效期</label>
                            <div class="col-md-10">
                                <div class="input-group date-picker input-daterange" data-date-format="yyyy-mm-dd">
                                    <input type="text" class="form-control" name="coupon_starttime">
                                    <span class="input-group-addon">
                                    到 </span>
                                    <input type="text" class="form-control" name="coupon_endtime">
                                </div>
                                
                                <span class="help-block">
                                选择时间段 </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-2">优惠方式</label>
                            <div class="radio-list col-md-9">
                                <label class="radio-inline">
                                <input type="radio" name="type" value="fixed" checked> 固定减免 </label>
                                <label class="radio-inline">
                                <input type="radio" name="type" value="discount"> 百分比折扣 </label>
                            </div>
                        </div>
                        <div class="form-group">
                        	<label class="control-label col-md-2">优惠金额</label>
                            <div class="col-md-10">
                            	<input type="text" name="num" class="form-control">
                                <span class="help-block">
                                百分比折扣的时候请输入一个小于1的数字 </span>
                            </div>
                            
                        </div>-->
                        <div class="form-group">
                        	<label class="control-label col-md-2">跳转方式</label>
                          	<div class="col-md-5">
                            	<select name="redict_type" size="1" class="form-control">
                                	<option value="none" {%if $register.redict_type==none%}selected{%/if%}>无跳转</option>
                                    <option value="index" {%if $register.redict_type==index%}selected{%/if%}>首页</option>
                                    <option value="theme" {%if $register.redict_type==theme%}selected{%/if%}>主题</option>
                                    <option value="product" {%if $register.redict_type==product%}selected{%/if%}>商品</option>
                                    <option value="url" {%if $register.redict_type==url%}selected{%/if%}>外部地址</option>
                              	</select>
                                <span class="help-block">
                                无跳转：停留在登陆后页面，首页：跳转到首页,主题：跳转到主题详情页,商品：跳转到商品详情页,外部地址，跳转到外部的url
                                 </span>
                            </div>
                            <div class="col-md-5 {%if $register.redict_type != url%}display-none{%/if%}" id="redict_url">
                           	  	<input type="text" class="form-control" name="redict_url">
                                <span class="help-block">
                                以http://开头的完整地址
                                 </span>
                            </div>
                            <div class="col-md-5 {%if $register.redict_type != theme%}display-none{%/if%}" id="redict_theme">
                           	  	<select class="form-control" name="redict_theme">
                                	{%section name=theme loop=$theme%}
                              		<option value="{%$theme[theme].id%}" {%if $register.redict == $theme[theme].id%}selected{%/if%}>{%$theme[theme].name%}</option>
                                    {%/section%}
                              	</select>
                            </div>
                            <div class="col-md-5 {%if $register.redict_type != product%}display-none{%/if%}" id="redict_product">
                           	  	<select class="form-control" name="redict_product">
                                	{%section name=product loop=$product%}
                              		<option value="{%$product[product].id%}" {%if $register.redict == $product[product].id%}selected{%/if%}>{%$product[product].name%}</option>
                                    {%/section%}
                              	</select>
                            </div>
                        </div>
                        <div class="form-group">
                        	<label class="control-label col-md-2">悬浮窗停留时间</label>
                            <div class="col-md-10">
                            	<input type="num" class="form-control" name="stoptime" value="{%$register.stoptime|default:'0'%}">
                                <span class="help-block">
                                单位秒,0不限制 </span>
                            </div>
                        </div>
                        </form>
                    </div>
				</div>
			</div>
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
	{%include file='admin/public/quickslider.html'%}
</div>
<!-- END CONTAINER -->
{%include file='admin/public/footer.html'%}
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/respond.min.js"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script type="text/javascript" src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- END CORE PLUGINS -->
<script src="{%$VIEW_ROOT%}/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/umeditor/umeditor.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/umeditor/umeditor.config.js" type="text/javascript"></script>
<script type="text/javascript" src="{%$VIEW_ROOT%}/assets/umeditor/lang/zh-cn/zh-cn.js"></script>
<script>
jQuery(document).ready(function() {	
	Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	QuickSidebar.init(); // init quick sidebar
	Demo.init(); // init demo features
	
	function htmlencode(s){  
		var div = document.createElement('div');  
		div.appendChild(document.createTextNode(s));  
		return div.innerHTML;  
	}  
	function htmldecode(s){  
		var div = document.createElement('div');  
		div.innerHTML = s;  
		return div.innerText || div.textContent;  
	}  
	
	$('.date-picker').datepicker({
		rtl: Metronic.isRTL(),
		orientation: "left",
		autoclose: true
	});
	
	window.um = UM.getEditor('umeditor');
	$(".edui-container").css('z-index','').css('width','100%');
	$('#umeditor').css('width','100%');
	
	$.get('{%url c=register a=information%}',{id:1},function(data){
		$('#content').html(htmldecode(data.body.content));
		$('#title').html(data.body.name);
	});
	
	$('#editBtn').on('click',function(){
		$('#container').addClass('display-none');
		$('#container_form').removeClass('display-none');
		window.um.setContent($('#content').html(),false);
		$('#container_form').find('input[name=title]').val($('#title').html());
	});
	
	$('#cancelBtn').on('click',function(){
		$('#container').removeClass('display-none');
		$('#container_form').addClass('display-none');
	});
	
	$('#container_form').on('submit',function(){
		var title = $(this).find('input[name=title]').val();
		var content = window.um.getContent();
		var ajax1 = $.post('{%url c=register a=save%}',{name:'name',value:title,id:1},function(response){
		});
		var ajax2 = $.post('{%url c=register a=save%}',{name:'content',value:content,id:1},function(response){
		});
		$.when(ajax1,ajax2).done(function(response){
			$('#content').html(content);
			$('#container').removeClass('display-none');
			$('#container_form').addClass('display-none');		
		});
		return false;
	});
	
	function redict_hide()
	{
		$('#redict_url').addClass('display-none');
		$('#redict_theme').addClass('display-none');
		$('#redict_product').addClass('display-none');
	}
	//redict_hide();
	$('select[name=redict_type]').on('change',function(){
		var value = $(this).val();
		switch(value)
		{
			case 'none':$(this).animate();
			case 'index':redict_hide();break;
			case 'product':redict_hide();$('#redict_product').removeClass('display-none');break;
			case 'url':redict_hide();$('#redict_url').removeClass('display-none');break;
			case 'theme':redict_hide();$('#redict_theme').removeClass('display-none');break;
		}
	});
	
	
	function externData(form)
	{
		var form = form;
		
		var save = function(event){
			var name = $(this).attr('name');
			var value = $(this).val();
			$.post('{%url c=register a=save%}',{id:1,name:name,value:value},function(response){
				if(response.code != 1)
				{
					Metronic.alert({
						type: 'danger',
						icon: 'warning',
						closeInSeconds: 5,
						message: response,
						container: $('#alert'),
						place: 'prepend'
					});
				}
			});
			if(name == 'redict_type')
			{
				switch(value)
				{
					case 'url':
						var name = 'redict_url';
						var value = $('input[name=redict_url]').val();
						break;
					case 'theme':
						var name = 'redict_theme';
						var value = $('select[name=redict_theme]').val();
						break;
					case 'product':
						var name = 'redict_product';
						var value = $('select[name=redict_product]').val();
						break;
					default:
						return false;
						break;
				}
				$.post('{%url c=register a=save%}',{name:name,value:value,id:1},function(response){
					if(response.code != 1)
					{
						Metronic.alert({
							type: 'danger',
							icon: 'warning',
							closeInSeconds: 5,
							message: response,
							container: $('#alert'),
							place: 'prepend'
						});
					}
				});
			}
		}
		
		$('input',form).on('change',save);
		$('select',form).on('change',save);
	}
	
	externData($('#externData'));
});
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>
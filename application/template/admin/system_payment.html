<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>结算设定 | {%$systemconfig.companyname|default:""%}后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/pace/pace.min.js" type="text/javascript"></script>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/pace/themes/pace-theme-barber-shop.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN THEME STYLES -->
<link href="{%$VIEW_ROOT%}/assets/global/css/components.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link id="style_color" href="{%$VIEW_ROOT%}/assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css"/>
<link href="{%$VIEW_ROOT%}/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
<!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
<!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
<!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
<!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
<!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
<!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
<body class="page-header-fixed page-quick-sidebar-over-content">
{%include file='admin/public/header.html'%}
<!-- BEGIN CONTAINER -->
<div class="page-container">
	{%include file='admin/public/sidebar.html'%}
    <!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<div class="modal fade" id="create_menu" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<form class="form-horizontal" role="form" id="create_menu_form">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								<h4 class="modal-title">添加新菜单</h4>
							</div>
							<div class="modal-body">
								<div class="form-group">
									<label class="col-md-2 control-label">名称</label>
									<div class="col-md-10">
										<input type="text" name="name" class="form-control">
										<span class="help-inline">
										菜单上显示的名称. </span>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-2 control-label">类型</label>
									<div class="col-md-10">
										<select class="form-control" name="type">
											<option value="click">点击推事件</option>
											<option value="view">跳转URL</option>
											<option value="scancode_push">扫码推事件</option>
											<option value="scancode_waitmsg">扫码推事件且弹出“消息接收中”提示框</option>
											<option value="pic_sysphoto">弹出系统拍照发图</option>
											<option value="pic_photo_or_album">弹出拍照或者相册发图</option>
											<option value="pic_weixin">弹出微信相册发图器</option>
											<option value="location_select">弹出地理位置选择器</option>
											<option value="media_id">下发消息（除文本消息）</option>
											<option value="view_limited">跳转图文消息URL</option>
										</select>
										<span class="help-inline">
										消息类型，参考微信开发文档 </span>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-2 control-label">Key</label>
									<div class="col-md-10">
										<input type="text" name="key" class="form-control" placeholder="保证Key唯一">
										<span class="help-inline">
										微信推送给服务器的消息，需要开发者开发后才可以使用 </span>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="submit" class="btn blue">保存</button>
								<button type="button" class="btn default" data-dismiss="modal">取消</button>
							</div>
						</form>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<div class="modal fade" id="create_submenu" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<form class="form-horizontal" role="form" id="create_submenu_form">
							<input type="hidden" name="id">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								<h4 class="modal-title">添加子菜单</h4>
							</div>
							<div class="modal-body">
								<div class="form-group">
									<label class="col-md-2 control-label">名称</label>
									<div class="col-md-10">
										<input type="text" name="name" class="form-control">
										<span class="help-inline">
										菜单上显示的名称. </span>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-2 control-label">类型</label>
									<div class="col-md-10">
										<select class="form-control" name="type">
											<option value="click">点击推事件</option>
											<option value="view">跳转URL</option>
											<option value="scancode_push">扫码推事件</option>
											<option value="scancode_waitmsg">扫码推事件且弹出“消息接收中”提示框</option>
											<option value="pic_sysphoto">弹出系统拍照发图</option>
											<option value="pic_photo_or_album">弹出拍照或者相册发图</option>
											<option value="pic_weixin">弹出微信相册发图器</option>
											<option value="location_select">弹出地理位置选择器</option>
											<option value="media_id">下发消息（除文本消息）</option>
											<option value="view_limited">跳转图文消息URL</option>
										</select>
										<span class="help-inline">
										消息类型，参考微信开发文档 </span>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-2 control-label">Key</label>
									<div class="col-md-10">
										<input type="text" name="key" class="form-control" placeholder="保证Key唯一">
										<span class="help-inline">
										微信推送给服务器的消息，需要开发者开发后才可以使用 </span>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="submit" class="btn blue">保存</button>
								<button type="button" class="btn default" data-dismiss="modal">取消</button>
							</div>
						</form>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			{%include file='admin/public/style.html'%}
			<!-- BEGIN PAGE HEADER-->
			<h3 class="page-title">
			结算 <small>用户支付方式</small>
			</h3>
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="{%url c=index a=index%}">首页</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">系统配置</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="{%url c=payment a=admin%}">结算</a>
					</li>
				</ul>
			</div>
			<!-- END PAGE HEADER-->
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-3">
                        <ul class="ver-inline-menu tabbable margin-bottom-10">
                        	<li class="active">
                            	<a data-toggle="tab" href="#base">
                                	<i class="fa fa-briefcase"></i> 基础设定
                                </a>
                                <span class="after">
                                </span>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#weixin">
                                <i class="fa fa-briefcase"></i> 微信支付 </a>
                            </li>
                            <li>
                                <a data-toggle="tab" href="#alipay">
                                <i class="fa fa-group"></i> 支付宝 </a>
                            </li>
                        </ul>
                   	</div>
					<div class="col-md-9">
						<div class="tab-content">
                        	<div id="base" class="tab-pane active">
                            	<form action="{%url c=system a=save%}" method="post" class="form-horizontal" role="form">
                                	<div class="form-group">
                                        <label class="col-md-2 control-label">支付超时</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_payment_timeout" value="{%$systemconfig.system_payment_timeout|default:"30"%}" class="form-control" placeholder="30">
                                            <span class="help-block">
                                            当订单在规定时间内没有支付，则按照取消订单处理. 单位分钟</span>
                                        </div>
                                    </div>
									<div class="form-group">
                                        <label class="col-md-2 control-label">支付阈值</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_payment_maxvalue" value="{%$systemconfig.system_payment_maxvalue|default:"0"%}" class="form-control" placeholder="单位元">
                                            <span class="help-block">
                                            当订单金额超过阈值的时候不允许支付，0为关闭</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                    	<label class="col-md-2 control-label"></label>
                                        <div class="col-md-10">
                                            <button type="submit" class="btn green col-md-12">保存</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
							<div id="weixin" class="tab-pane">
								<form action="{%url c=system a=save%}" method="post" class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">MCHID</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_weixin_mchid" value="{%$systemconfig.system_weixin_mchid|default:""%}" class="form-control" placeholder="1226923702">
                                            <span class="help-block">
                                            微信商户编码. </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">APPID</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_weixin_appid" value="{%$systemconfig.system_weixin_appid|default:""%}" class="form-control" placeholder="wxacf21161e3c578f1">
                                            <span class="help-block">
                                            微信公众平台上的APPID. </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">Key</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_weixin_key" value="{%$systemconfig.system_weixin_key|default:""%}" class="form-control" placeholder="Zhy781525073AsDfGh12ZgdZxCvBnMlK">
                                            <span class="help-block">
                                            加密密钥. </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">APPSECRET</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_weixin_appsecret" value="{%$systemconfig.system_weixin_appsecret|default:""%}" class="form-control" placeholder="a9edccfb3018342657334dabd8873357">
                                            <span class="help-block">
                                            微信公众平台上的appsecret. </span>
                                        </div>
                                    </div>
									<div class="form-group">
                                        <label class="col-md-2 control-label">TOKEN</label>
                                        <div class="col-md-10">
                                            <input type="text" name="system_weixin_token" value="{%$systemconfig.system_weixin_token|default:""%}" class="form-control" placeholder="微信公众平台的TOKEN">
                                            <span class="help-block">
                                            接入微信公众平台的TOKEN（3-32位）. </span>
                                        </div>
                                    </div>
									<div class="form-group">
                                        <label class="col-md-2 control-label">接入地址</label>
                                        <div class="col-md-10">
                                            <input disabled type="text" value="http://{%$smarty.server.HTTP_HOST%}{%$smarty.server.PHP_SELF|substr:0:-10%}/index.php?c=wechat&a=router" class="form-control">
                                            <span class="help-block">
                                            微信公众平台接入地址. </span>
                                        </div>
                                    </div>
									<div class="form-group">
                                        <label class="col-md-2 control-label">微信自动登陆</label>
                                        <div class="col-md-10">
                                            <select name="system_weixin_autologin" class="form-control">
												<option value="0" {%if isset($systemconfig.system_weixin_autologin) && $systemconfig.system_weixin_autologin==0%}selected="selected"{%/if%}>关闭</option>
												<option value="1" {%if isset($systemconfig.system_weixin_autologin) && $systemconfig.system_weixin_autologin==1%}selected="selected"{%/if%}>开启</option>
											</select>
                                            <span class="help-block">
                                            微信端自动登陆注册，起开自动登陆，才可以开启分享的上级id分配 </span>
                                        </div>
                                    </div>
									<div class="col-md-offset-2 col-md-10">
										<div class="portlet box blue">
											<div class="portlet-title">
												<div class="caption">
													<i class="fa fa-gift"></i>自定义菜单(需要配置好微信公众平台)
												</div>
												
											</div>
											<div class="portlet-body">
												<div class="tab-content" id="menu_container">
													<div class="btn-group menu display-none" id="menu_template">
														<a class="btn purple name" href="#" data-toggle="dropdown">
														Settings <i class="fa fa-angle-down"></i>
														</a>
														<ul class="dropdown-menu bottom-up">
															<li>
																<a href="#create_submenu" class="create_submenu" data-id="" data-toggle="modal">
																<i class="fa fa-plus"></i> 添加子菜单 </a>
															</li>
															<li>
																<a href="#" class="menu_remove_btn" data-id="">
																<i class="fa fa-times"></i> 删除一级菜单 </a>
															</li>
															<li class="divider">
															</li>
														</ul>
													</div>
													<div class="btn-group" id="create_menu_btn">
														<a href="#create_menu" data-toggle="modal" class="btn red">
														<i class="fa fa-plus"></i> 添加菜单
														</a>
													</div>
												</div>
											</div>
										</div>
									</div>
                                    <div class="form-group">
                                    	<label class="col-md-2 control-label"></label>
                                        <div class="col-md-10">
                                            <button type="submit" class="btn green col-md-12">保存</button>
                                        </div>
                                    </div>
                                </form>
							</div>
                            <div id="alipay" class="tab-pane">
                            	<form action="{%url c=system a=save%}" method="post" enctype="multipart/form-data" class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">支付方式</label>
                                    <div class="col-md-10">
                                    	<select name="system_alipay_outtrade" class="form-control">
                                        	<option value="1" {%if isset($systemconfig.system_alipay_outtrade) && $systemconfig.system_alipay_outtrade == 1%}selected="true"{%/if%}>支付到海外账户</option>
                                            <option value="0" {%if isset($systemconfig.system_alipay_outtrade) && $systemconfig.system_alipay_outtrade == 0%}selected="true"{%/if%}>支付到国内账户</option>
                                        </select>
                                        <span class="help-block">
                                        支付宝账号类型. </span>
                                    </div>
                                </div>
								<div class="form-group">
                                    <label class="col-md-2 control-label">Partner</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_partner" value="{%$systemconfig.system_alipay_partner|default:""%}" class="form-control" placeholder="2088021017666931">
                                        <span class="help-block">
                                        支付宝的商户编号以2088开头的. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">Key</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_key" value="{%$systemconfig.system_alipay_key|default:""%}" class="form-control" placeholder="4508mayei5zbmsmopp6tlobdf83d2kz6">
                                        <span class="help-block">
                                        MD5加密密钥. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">RSA加密私钥</label>
                                    <div class="col-md-8">
                                        <input type="file" name="system_alipay_rsaprivatekey" class="form-control">
                                        <span class="help-block">
                                        rsa加密的私钥. 公钥放在支付宝</span>
                                    </div>
                                    {%if isset($systemconfig.system_alipay_rsaprivatekey) && !empty($systemconfig.system_alipay_rsaprivatekey)%}
                                    <label class="col-md-2 control-label"><a href="{%resource path=$systemconfig.system_alipay_rsaprivatekey%}">RSA私钥查看</a></label>
                                    {%/if%}
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">支付宝RSA公钥</label>
                                    <div class="col-md-8">
                                        <input type="file" name="system_alipay_rsapublickey" class="form-control">
                                        <span class="help-block">
                                        支付宝的RSA公钥</span>
                                    </div>
                                    {%if isset($systemconfig.system_alipay_rsapublickey) && !empty($systemconfig.system_alipay_rsapublickey)%}
                                    <label class="col-md-2 control-label"><a href="{%resource path=$systemconfig.system_alipay_rsapublickey%}">RSA公钥查看</a></label>
                                    {%/if%}
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">货币代码</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_currency" class="form-control" placeholder="EUR" value="{%$systemconfig.system_alipay_currency|default:""%}">
                                        <span class="help-block">
                                        货币代号，前提是需要在支付宝开通. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">开启海外分账</label>
                                    <div class="col-md-10">
                                    	<select name="system_alipay_splitopen" class="form-control">
                                        	<option value="1" {%if isset($systemconfig.system_alipay_splitopen) && $systemconfig.system_alipay_splitopen == 1%}selected="true"{%/if%}>开启</option>
                                            <option value="0" {%if isset($systemconfig.system_alipay_splitopen) && $systemconfig.system_alipay_splitopen == 0%}selected="true"{%/if%}>关闭</option>
                                        </select>
                                        <span class="help-block">
                                        支付宝的商户编号以2088开头的. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">分账Partner</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_splitpartner" value="{%$systemconfig.system_alipay_splitpartner|default:""%}" class="form-control" placeholder="2088801766902304">
                                        <span class="help-block">
                                        支付宝的商户编号以2088开头的. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">分账比例</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_splitrate" value="{%$systemconfig.system_alipay_splitrate|default:""%}" class="form-control" placeholder="0.5">
                                        <span class="help-block">
                                        小于1并且大于0的数字，不能等于1或等于0. </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">分账货币</label>
                                    <div class="col-md-10">
                                        <input type="text" name="system_alipay_splitcurrency" class="form-control" placeholder="CNY" value="{%$systemconfig.system_alipay_splitcurrency|default:""%}">
                                        <span class="help-block">
                                        分账账号的货币. </span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="col-md-2 control-label"></label>
                                    <div class="col-md-10">
                                        <button type="submit" class="btn green col-md-12">保存</button>
                                    </div>
                                </div>
                                </form>
							</div>
						</div>
                    </div>
				</div>
			</div>
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
	{%include file='admin/public/quickslider.html'%}
</div>
<!-- END CONTAINER -->
{%include file='admin/public/footer.html'%}
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/respond.min.js"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<script src="{%$VIEW_ROOT%}/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="{%$VIEW_ROOT%}/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script>
jQuery(document).ready(function() {	
	Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	QuickSidebar.init(); // init quick sidebar
	Demo.init(); // init demo features
	
	
	function drwa_menu()
	{
		var menu = $('#menu_container').find('.menu');
		$.each(menu,function(index,value){
			if($(value).hasClass('display-none'))
			return;
			$(value).remove();
		});
		$.get('{%url c=wechat a=menu action=fetch%}',{},function(response){
			var menu = response.body;
			for(var i=0;i<menu.length;i++)
			{
				var tpl = $('#menu_template').clone();
				tpl.removeClass('display-none').find('.name').html(menu[i].name+' <i class="fa fa-angle-down"></i>');
				tpl.find('.menu_remove_btn').attr('data-id',menu[i].id);
				tpl.find('.create_submenu').attr('data-id',menu[i].id);
				tpl.insertBefore($('#create_menu_btn'));
				if(menu[i].sub_button)
				{
					
					var submenu = menu[i].sub_button;
					for(var j=0;j<submenu.length;j++)
					{
						var subtpl = '<li><a href="#" data-id="'+submenu[j].id+'" class="remove_submenu_btn"><i class="i"></i> '+submenu[j].name+'(点击删除子菜单) </a></li>';
						tpl.find('.dropdown-menu').append(subtpl);
					}
				}
			}
		});
	}
	drwa_menu();
	
	$('.menu_remove_btn').live('click',function(event){
		var id = $(this).data('id');
		var ths = $(this);
		$.post('{%url c=wechat a=menu action=delete%}',{id:id},function(response){
			if(response.code == 1)
			{
				ths.parents('.btn-group').remove();
			}
		});
		return false;
	});
	
	$('#create_menu_form').on('submit',function(){
		var name = $.trim($(this).find('[name=name]').val());
		var type = $(this).find('[name=type]').val();
		var key = $(this).find('[name=key]').val();
		$.post('{%url c=wechat a=menu action=create%}',{name:name,type:type,key:key},function(response){
			if(response.code == 1)
			{
				var tpl = $('#menu_template').clone();
				tpl.removeClass('display-none').find('.name').html(name+' <i class="fa fa-angle-down"></i>');
				tpl.find('.menu_remove_btn').attr('data-id',response.body);
				tpl.find('.create_submenu').attr('data-id',response.body);
				tpl.insertBefore($('#create_menu_btn'));
				$('#create_menu').modal('hide');
			}
			else
			{
				alert(response.result);
			}
		});
		return false;
	});
	
	$('#create_submenu').bind('show.bs.modal',function(event){
		var id = $(event.relatedTarget).data('id');
		$(this).find('input[name=id]').val(id);
	});
	
	$('#create_submenu_form').on('submit',function(){
		var id = $('#create_submenu_form').find('[name=id]').val();
		var name = $('#create_submenu_form').find('[name=name]').val();
		var type = $('#create_submenu_form').find('[name=type]').val();
		var key = $('#create_submenu_form').find('[name=key]').val();
		$.post('{%url c=wechat a=menu action=create%}',{id:id,name:name,type:type,key:key},function(response){
			if(response.code == 1)
			{
				$('#create_submenu').modal('hide');
				var tpl = '<li><a href="#" data-id="'+response.body+'" class="remove_submenu_btn"><i class="i"></i> '+name+'(点击删除子菜单) </a></li>';
				$('.menu_remove_btn[data-id='+id+']').parents('.dropdown-menu').append(tpl);
			}
			else
			{
				alert(response.result);
			}
		});
		return false;
	});
	
	$('.remove_submenu_btn').live('click',function(){
		var id = $(this).data('id');
		var ths = $(this);
		$.post('{%url c=wechat a=menu action=delete%}',{id:id},function(response){
			if(response.code == 1)
			{
				//ths.parents('li').remove();
				ths.remove();
			}
			else
			{
				alert(response.result);
			}
		});
		return false;
	});
	
	$('#weixin').find('button').on('click',function(event){
		$.ajax({
			async:false,
			type:'get',
			url:"{%url c=wechat a=menu action=save%}",
			success: function(response){
				if(response.code != 1)
				{
					alert(response.result);
				}
			}
		});
	});
});
   </script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>